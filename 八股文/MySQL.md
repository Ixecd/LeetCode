# MySQL 八股

## 间隙锁/记录锁/临键锁
- **MySQL**默认的隔离级别是RR(可重复读),但是RR在MVCC的加持下还是存在幻读
- 间隙锁就是用来在RR级别下解决幻读的问题
- 幻读:当前事务多次的查询结果数量上不一致,间隙锁的目的就是保证当前范围内的数据不会被更改,会锁住某个区间的数据

- 记录锁:基于索引记录上的锁,锁定的函数是固定的/明确的,可以是共享锁/排他锁

- 临键锁:等价于**记录锁+间隙锁**

- MySQL默认级别是RR,默认锁上临键锁

- 锁都是基于索引去找到数据记录再加锁的,而索引的规则是:通过其他索引找到主键索引
    1. 没有使用索引做更新相关操作会**锁整张表**
    2. 通过唯一/主键索引等值加锁,只会锁住具体的行,非唯一索引则不一定
    3. 只有在RR级别下才有间隙锁,目的是为了解决幻读,如果操作的数据是跨多个范围,就会加多个区间的间隙锁
    4. MySQL默认的锁就是**临键锁**,在执行SQL的时候,记录锁和间隙锁是会同时存在的,范围是左开右闭的区间

## 意向锁
- 意向锁分为**意向共享锁**和**意向排他锁**
- 如果要使用共享锁和排他锁,就得一行一行去便利看看数据有没有被排他锁(共享锁)锁过
- 上面的代价太大,所以对某些数据加共享锁的时候,会给表加上 **意向共享锁**,对某些数据加排他锁的时候就会对**表**加上**意向排他锁**,就不需要遍历,意向锁之间是不冲突的,级别是表

