# 计算机网络常见知识点

## 七层网络模型
**物(物理层)**

**数(数据链路层)**

**网(网络层)**

**传(传输层)**

**会(会话层)**

**表(表示层)**

**应(应用层)**

## TCP/IP网络模型

*应用层*
- 只专注于为用户提供应用功能,比如HTTP、FTP、DNS、SMTP等
- 应用层是工作在操作系统中的用户态,**传输层及以下工作在内核态**
- 向下传输**应用程序数据**

*传输层*
- 为应用层提供网络支持
- 设计理念是简单、高效、专注,并不负责将数据从一个设备传输到另一个设备上
- 有两个传输协议TCP和UDP
- 传输层数据包超过MSS(TCP最大报文长度),就会分块,每个分块称为一个**TCP段**
- 在应用程序数据头加上**TCP/UDP头**,向下传输**报文**

*网络层*
- 负责实际的传输功能,逻辑上
- 最常使用的是IP协议,IP报文超过MTU(以太网中一般1500字节)就会**分片**
- 对于IPv4协议,IP地址一共32位,共四段,每段是8位
- IP地址有两种意义,需要配合子网掩码
    1. 网络号,标识该ip地址是属于哪个子网的
    2. 主机号,标识同一子网下的不同主机
- 在寻址过程中,先匹配到相同的网络号,找同一子网,之后才会去找对应的主机
- IP的另一个很重要的能力**路由**,两设备之间通常有很多网关/路由器/交换机
- IP中还包括**ICMP**和**ARP**协议
- 路由根据IP给的下一个目的地来选择路径
- 在报文头部加上**IP头**向下传递

*网络接口层*
- 负责为网络层提供**物理链路**传输服务,使用MAC地址这个唯一标识,来识别网络上的设备
- 使用ARP协议来获取对方的MAC地址

# Q&A
## 键入网址到网页显示，期间发生了什么？
1. 浏览器解析URL
2. 根据解析内容生成HTTP请求
3. 查询**服务器域名对应的IP地址**,DNS服务器专门保存了**Web服务器**和**IP**对应关系
4. 委托操作系统(调用socket库)将消息发送给Web服务器,操作系统有协议栈,分为上半部分(TCP/UDP)和下半部分(IP/ICMP/ARP)
5. 通过添加TCP/UDP头部生成报文,传递给IP层
6. IP模块将数据封装成**网络包(IP报文)**发送给通信对象
7. 在网络接口层对IP报文头部添加上MAC头部信息
8. 通过**网卡**将数字信息转化为电信号,控制网卡还需要**网卡驱动程序**
9. **网卡驱动**获取到网络包后,会将其**复制**到网卡内的缓存区中,之后在其**开头加上报头和起始帧分界符,在末尾加上用于检测错误的帧校验序列**
10. 通过**交换机**将网络包**原样**转发到目的地,其工作在MAC层,**交换机的端口不具有MAC地址**,转发端口,到路由器上
11. **路由器**基于IP设计(也有ARP缓存),俗称三层网络设备,各个端口都具有MAC地址和IP地址,之后**丢弃MAC头部**,重新在**路由表**中判断转发目标,找到对应目标,判断目标的**网关**,如果网关是一个IP地址,那这个IP就是要转发的目标地址,表示**还未抵达终点**,继续路由转发(通过ARP获取MAC),如果网关为空,说明已经到达终点
- 注意:子啊网络包传输的过程中,**源IP和目的IP始终不会发生变化,一直变化的是MAC地址**

